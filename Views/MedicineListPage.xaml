<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MedicinesTracker.Views.MedicineListPage"
             xmlns:viewModels="clr-namespace:MedicinesTracker.ViewModels"
             Title="Лекарства">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <VerticalStackLayout Grid.Row="0">
            <CollectionView ItemsSource="{Binding Medicines}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,10">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MedicineListVM}}, Path=MedicineTappedCommand}"
                                    CommandParameter="{Binding .}" />   
                            </Border.GestureRecognizers>
                            <StackLayout Padding="10" 
                                         Spacing="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <!-- Получатель -->
                                    <Label Text="{Binding Recipient.Name}"
                                           FontSize="14"
                                           TextColor="#555"
                                           Opacity="0.8"
                                           Grid.Column="0"
                                           VerticalOptions="Center"/>
                                    <!-- Остаток на складе -->
                                    <Border BackgroundColor="{StaticResource Primary}"
                                            Padding="10,5"
                                            HorizontalOptions="End"
                                            Grid.Column="1">
                                        <HorizontalStackLayout Spacing="5">
                                            <Label Text="{Binding Stock.CurrentQuantity, StringFormat='Осталось {0}'}"
                                                   FontSize="14"
                                                   TextColor="{StaticResource Secondary}"/>
                                            <Label Text="{Binding Unit.Name}"
                                                   FontSize="14"
                                                   TextColor="{StaticResource Secondary}"/>
                                        </HorizontalStackLayout>
                                            
                                    </Border>
                                </Grid>
                                <!-- Основная информация о лекарстве -->
                                <VerticalStackLayout Spacing="5">
                                    <HorizontalStackLayout Spacing="10">
                                        <Image Source="medicine_card_icon.png"
                                               WidthRequest="30"
                                               HeightRequest="30"/>
                                        <Label Text="{Binding Name}"
                                               FontSize="16"
                                               VerticalOptions="Center"
                                               FontFamily="OpenSansSemibold"/>
                                    </HorizontalStackLayout>
                                    <!-- Список напоминаний -->
                                    <Label Text="{Binding ScheduleString}"
                                           FontSize="14"
                                           VerticalOptions="Center"
                                           Opacity="0.8"
                                           TextColor="{StaticResource Gray500}"/>
                                </VerticalStackLayout>
                                
                                <StackLayout>
                                    <Label Text="Посмотреть подробную информацию →"
                                           FontSize="14"
                                           TextColor="{StaticResource PrimaryDark}"/>
                                </StackLayout>
                            </StackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
        <HorizontalStackLayout Grid.Row="1" HorizontalOptions="End">
            <Button Text="Добавить"
                ImageSource="add_icon.png"
                FontFamily="OpenSansSemibold"
                BackgroundColor="{StaticResource PrimaryDark}"/>
        </HorizontalStackLayout>
    </Grid>
</ContentPage>
